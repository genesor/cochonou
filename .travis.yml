sudo: required

language: go

go:
    - 1.8

services:
    - docker

env:
  global:
    - COMMIT=${TRAVIS_COMMIT::8}
    - BRANCH=${TRAVIS_BRANCH}

before_install:
    - sudo apt-get update
    - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-engine

install:
    - go get github.com/Masterminds/glide
    - glide install

script:
    - go test $(glide novendor)
    - docker build -t quay.io/genesor/cochonou:$BRANCH-$COMMIT .
    - docker login quay.io -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    - docker push quay.io/genesor/cochonou:$BRANCH-$COMMIT
